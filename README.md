# NeuropixelSpont
Analyses of multi-brain Neuropixels recordings of mice during spontaneous behaviors.

The dataset is publicly available at [link](https://janelia.figshare.com/articles/dataset/Eight-probe_Neuropixels_recordings_during_spontaneous_behaviors/7739750), consisting of electrophysiological recordings (plus neuron locations, brain regions, etc.) and video recordings.

The MATLAB scripts `processNeuralActivity.m` and `createBehaviorLabels.m` process the neural data and videos respectively. Make sure to change the path variables in the scripts for them to properly load the downloaded data and save the processed data at desired locations on the local machine. The results include `ephys_[mouse_name].mat` (neural data) and `behav_[mouse_name].mat` (behavioral data) for every mouse which should all be in one folder. Finally, all processed data can be loaded into workspace using the function `load_data` from `helper_functions.py`.

```
from helper_functions import load_data

# ephys_data : list of dictionaries, each containing the processed neural activity and neuron locations of a mouse.
# behav_data : list of dictionaries, each containing the behavioral variables extracted from the video recording of a mouse.
# names      : list of names of mice.
ephys_data, behav_data, names = load_data()

# mice_colors   : list of colors, one for each mouse.
# region_colors : list of colors, one for each brain region.
# behav_colors  : list of colors, one for each behavioral state.
mice_colors, region_colors, behav_colors = generate_colors()

# Customize default matplotlib parameters
plot_config()

```

`load_data` reads the processed data from the `.mat` files and package them into Python dictionaries for easy access. Specifically, `ephys_data` is a list of dictionaries containing the following information:
- `'spkmat'` : matrix of shape (n_neurons, n_time_points) in which each row contained the filtered spiking activity of a single neuron
- `'tpoints'` : time points of the filtered spiking activity (length=n_time_points)
- `'regIDs'` : brain region indices assigned to the neurons
- `'reglbs'` : names of brain regions corresponding to the indices
- `'coords'` : 3D anatomical location of neurons in Allen Common Coordinate Framework (CCF)
- `'probeIDs'` : ID of the probes used to record the neurons
- `'heights'` : vertical position of neurons on the associated probes

Behavior variables extracted from the videos are stored in `behav_data`, including:
- `'whisk_cont'`, `'lomot_cont'` : $L^2$-norms of pixel change within the regions of interest (ROIs)
- `'whisk_dist'`, `'lomot_disc'` : time series of behavioral event indicators
- `'time_pts'` : time points of the behavioral time series

Color assignments for mice, behavioral states and brain regions are generated by `generate_colors` to ensure consistency between plots. `ephys_data`, `behav_data` and the color variables are the main inputs into the functions which performed analyses on the processed data and plot the results. The functions are divided into following modules:

#### [About Dataset]
- ``
#### [Auxiliary Functions](https://github.com/trannttoan/NeuropixelSpont/blob/main/Python/helper_functions.py)
- `plot_config` : set default parameters for matplotlib
- `generate_colors` : generate colors for mice, behavioral states and brain regions to be used across all plots
- `load_data` : load processed data from `.mat` files into the current workspace
#### [Behavior Variables](https://github.com/trannttoan/NeuropixelSpont/blob/main/Python/behavior_extraction.py)
- `label_tpoints` : Align behavioral event indicators with neural recording time and create a mask for each behavioral state
- `plot_behavior_variables` : Plot example frames along with ROIs and corresponding behavior variables
#### [Clustering Analysis](https://github.com/trannttoan/NeuropixelSpont/blob/main/Python/clustering_analysis.py)
- `plot_hclust_vs_behavior` : Perform correlation-distance-based hierarchical clustering on each of the behavior-based partition of population activity and plot distance matrices sorted based on the resulting dendrograms
- `plot_cophenetic_vs_behavior` : Perform correlation-distance-based hierarchical clustering on each of the behavior-based partition of population activity and plot the cophenetic coefficients of the resulting dendrograms
- `compute_silhouette_vs_behavior` : Compute Silhouette coefficients based on brain region labels and correlation distance between neural time series for each behavioral state
- `plot_silhouette_vs_behavior` : Create Silhouette plots for the behavior-based partitions of population activity (Silhouette coefficients are computed based on brain region labels and correaltion distance between segmented neural time series)
- `plot_silhouette_kstest` :     Perform kolmogorov-smirnov test on pairs of Silhouette samples and plot the ECDFs along with the resulting KS statistics
#### [Graph-theoretic Metrics](https://github.com/trannttoan/NeuropixelSpont/blob/main/Python/knn_graph)
-
#### [Dimensionality Reduction](https://github.com/trannttoan/NeuropixelSpont/blob/main/Python/umap_embeddings.py)
- `create_umap_vs_nneighbors` : Generate the given number of UMAP embeddings for each of the given numbers of nearest neighbors
- `plot_umap_vs_nneighbors` : Plot the UMAP embeddings generated by the create_umap_vs_nneighbors function
- `plot_silhouette_vs_nneighbors` : Plot mean Silhouette standard deviation of UMAP embeddings versus the number of nearest neighbors (For each neuron, the standard deviation of Silhouette coefficients is computed across UMAP embebdings with the same number of nearest neighbors)



